"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var got=_interopDefault(require("got")),cookie=_interopDefault(require("cookie")),jsdom=require("jsdom"),__chunk_1=require("./chunk-2618d45d.js"),__chunk_2=require("./chunk-568fa434.js");require("path"),require("fs"),require("filenamify"),require("make-dir"),require("chalk"),require("readline"),require("util"),require("crypto"),require("mime-types");const got$1=(e,t={})=>(t.headers=Object.assign({},t.headers),/^novel18./.test(e.hostname)&&(t.headers.cookie=cookie.serialize("over18","yes")),got(e,t));class Chapter extends __chunk_1.Chapter{async update(){const{props:e}=this,t=e.files;if(delete e.files,e.buffer&&!e.doc)return void(e.files=[{fname:this.getName(`${e.title}.txt`),integity:void 0,buffer:e.buffer}]);let r=e.doc;if(!r){if(!e.sourceURL)return;r=await(async()=>{let{window:{document:t}}=new jsdom.JSDOM((await got$1(e.sourceURL)).body,{url:e.sourceURL});return t})()}let o=[],n=[];for(const e of r.querySelectorAll("#novel_color img")){let t=r.createTextNode(`![](${e.src})`);e.parentNode.replaceChild(t,e),n.push(e.src)}{const t=await e.buffer;let n=t?"function"==typeof t?await t():t.toString():"";const i=[".novel_subtitle","#novel_p","#novel_honbun","#novel_a"];for(const e of i)for(const t of r.querySelectorAll(e))n+=t.textContent+"\n\n-----\n\n";o.push({fname:this.getName(`${e.title}.txt`),integity:void 0,buffer:n})}await __chunk_2.getExternal({prefix:this.prefix,oldFiles:t,files:o,urls:n}),e.files=o}}class Volume extends __chunk_1.Volume{}class Series extends __chunk_1.Series{constructor(e,...t){if(super(e,...t),!Series.test(this.sourceURL))throw new Error("Invalid URL")}static test(e){return/^((http|https):\/\/|)(ncode|novel18).syosetu.com\/[^\/]+\/?$/.test(e)}get Chapter(){return Chapter}get Volume(){return Volume}async fetch(){const e=this.sourceURL;let{window:{document:t}}=new jsdom.JSDOM((await got$1(e)).body,{url:e}),r=[],o=[],n="";{const e=t.querySelector(".novel_title").textContent.trim(),r=t.querySelector(".novel_writername").textContent.trim().substr("作者：".length);n=`# ${e}\nAuthor: ${r}\n\n`;let i=!1;{let e=t.querySelector("#novel_ex");null!=e?n+=e.textContent:i=!0,n+="\n\n-----\n\n"}o.push({title:"Description",integrity:Date.now(),buffer:()=>n,doc:i?t:void 0})}let i=-1,s=t.querySelector(".index_box");if(null==s)return this.setProps({chapters:o});let l=[];for(const t of s.children)if(t.classList.contains("chapter_title")){let e=t.textContent.trim();r.push({title:e}),n+=`\n## ${e}\n`,++i}else if(t.classList.contains("novel_sublist2")){let r=Number(i);l.push((async()=>{let{textContent:o,href:i}=(()=>{let e=t.firstElementChild.firstElementChild;return"a"!==e.nodeName.toLowerCase()&&(e=t.querySelector("a")),e})();return o=o.trim(),n+=`${String(l.length+1).padStart(3,"0")} ${o}\n`,i.startsWith("//")?i=e.protocol+i:i.startsWith("/")&&(i=new URL(i,e.origin)),{volume:r,sourceURL:i,title:o,integrity:(()=>{let e=(()=>{let e=t.lastElementChild;return e.classList.contains("long_update")?e:t.querySelector(".long_update")})(),r=e.lastElementChild;return r?r.title.trim():e.innerHTML.trim()})()}})())}return o[0].integrity=__chunk_2.hash(n),o=o.concat(await Promise.all(l)),this.patch({volumes:r,chapters:o})}}exports.Chapter=Chapter,exports.Volume=Volume,exports.Series=Series,exports.default=Series;
//# sourceMappingURL=app.min3.js.map
