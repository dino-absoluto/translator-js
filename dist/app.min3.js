"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var __chunk_1=require("./chunk-526f491f.js"),cookie=_interopDefault(require("cookie")),__chunk_2=require("./chunk-914cbf0a.js"),gotBase=_interopDefault(require("got")),jsdom=require("jsdom");require("path"),require("fs"),require("make-dir"),require("filenamify"),require("chalk"),require("readline"),require("util"),require("cli-truncate"),require("crypto"),require("mime-types");const got=(e,t={})=>(e=new URL(e),t.headers=Object.assign({},t.headers),/^novel18./.test(e.hostname)&&(t.headers.cookie=cookie.serialize("over18","yes")),gotBase(e,t));class Chapter extends __chunk_1.Chapter{async updateFiles(){const{props:e}=this,t=Object.assign({},e,{prefix:this.prefix,got:got});return __chunk_2.toFiles(t,async(t,r)=>{let n=[],o=await r.getImages("#novel_color img");{const r=await e.buffer;let o=r?"function"==typeof r?await r():r.toString():"";const i=[".novel_subtitle","#novel_p","#novel_honbun","#novel_a"];for(const e of i)for(const r of t.querySelectorAll(e))o+=r.textContent+"\n\n-----\n\n";n.push({fname:this.getName(`${e.title}.txt`),integity:void 0,buffer:o})}return[n,o]})}}class Volume extends __chunk_1.Volume{}class Series extends __chunk_1.Series{constructor(e,...t){if(super(e,...t),!Series.test(this.sourceURL))throw new Error("Invalid URL")}static test(e){return/^((http|https):\/\/|)(ncode|novel18).syosetu.com\/[^\/]+\/?$/.test(e)}get Chapter(){return Chapter}get Volume(){return Volume}async fetch(){const e=this.sourceURL;let{window:{document:t}}=new jsdom.JSDOM((await got(e)).body,{url:e}),r=[],n=[],o="";{const e=t.querySelector(".novel_title").textContent.trim(),r=t.querySelector(".novel_writername").textContent.trim().substr("作者：".length);o=`# ${e}\nAuthor: ${r}\n\n`;let i=!1;{let e=t.querySelector("#novel_ex");null!=e?o+=e.textContent:i=!0,o+="\n\n-----\n\n"}n.push({title:"Description",integrity:Date.now(),buffer:()=>o,doc:i?t:void 0})}let i=-1,s=t.querySelector(".index_box");if(null==s)return this.setProps({chapters:n});let l=[];for(const t of s.children)if(t.classList.contains("chapter_title")){let e=t.textContent.trim();r.push({title:e}),o+=`\n## ${e}\n`,++i}else if(t.classList.contains("novel_sublist2")){let r=Number(i);l.push((async()=>{let{textContent:n,href:i}=(()=>{let e=t.firstElementChild.firstElementChild;return"a"!==e.nodeName.toLowerCase()&&(e=t.querySelector("a")),e})();return n=n.trim(),o+=`${String(l.length+1).padStart(3,"0")} ${n}\n`,i.startsWith("//")?i=e.protocol+i:i.startsWith("/")&&(i=new URL(i,e.origin)),{volume:r,sourceURL:i,title:n,integrity:(()=>{let e=(()=>{let e=t.lastElementChild;return e.classList.contains("long_update")?e:t.querySelector(".long_update")})(),r=e.lastElementChild;return r?r.title.trim():e.innerHTML.trim()})()}})())}return n[0].integrity=__chunk_2.hash(o),n=n.concat(await Promise.all(l)),this.patch({volumes:r,chapters:n})}}exports.Chapter=Chapter,exports.Volume=Volume,exports.Series=Series,exports.default=Series;
//# sourceMappingURL=app.min3.js.map
