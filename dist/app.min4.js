"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var __chunk_1=require("./chunk-2618d45d.js"),jsdom=require("jsdom"),got=_interopDefault(require("got")),__chunk_2=require("./chunk-568fa434.js");require("path"),require("fs"),require("filenamify"),require("make-dir"),require("chalk"),require("readline"),require("util"),require("crypto"),require("mime-types");class Chapter extends __chunk_1.Chapter{async update(){const{props:e}=this,t=e.files;if(delete e.files,e.buffer&&!e.doc)return void(e.files=[{fname:this.getName(`${e.title}.txt`),integity:void 0,buffer:e.buffer}]);let r=e.doc;if(!r){if(!e.sourceURL)return;r=await(async()=>{let{window:{document:t}}=new jsdom.JSDOM((await got(e.sourceURL)).body,{url:e.sourceURL});return t})()}let i=[],s=[],n=r.getElementById("contentMain-inner");for(const e of n.getElementsByTagName("img")){let t=r.createTextNode(`![](${e.src})`);e.parentNode.replaceChild(t,e),s.push(e.src)}e.files=i;{const t=await e.buffer;let r=t?"function"==typeof t?await t():t.toString():"";const s=["widget-episodeTitle","widget-episode"];for(const e of s)for(const t of n.getElementsByClassName(e))r+=t.textContent+"\n\n-----\n\n";i.push({fname:this.getName(`${e.title}.txt`),integity:void 0,buffer:r})}await __chunk_2.getExternal({prefix:this.prefix,oldFiles:t,files:i,urls:s})}}class Volume extends __chunk_1.Volume{}class Series extends __chunk_1.Series{static test(e){return/^((http|https):\/\/|)kakuyomu.jp\/works\/[^\/]+\/?$/.test(e)}get Chapter(){return Chapter}get Volume(){return Volume}async fetch(){const e=this.sourceURL;let{window:{document:t}}=new jsdom.JSDOM((await got(e)).body,{url:e}),r=[],i=[],s="";{let e="";e+=t.getElementById("workTitle").textContent+"\n",e+=`Author: ${t.getElementById("workAuthor-activityName").textContent}\n`,e+=`\n${t.getElementById("introduction").textContent}\n`,s+=e,e=void 0,i.push({title:"Description",integrity:Date.now(),buffer:()=>s})}let n=-1;for(const e of t.getElementsByClassName("widget-toc-items"))for(const t of e.children)if(t.classList.contains("widget-toc-chapter")){let e=t.textContent.trim();r.push({title:e}),s+=`\n## ${e}\n`,++n}else{let e=t.getElementsByClassName("widget-toc-episode-episodeTitle")[0],r=e.href,o=e.getElementsByClassName("widget-toc-episode-titleLabel")[0].textContent,u=e.getElementsByClassName("widget-toc-episode-datePublished")[0].getAttribute("datetime");s+=`${String(i.length).padStart(3,"0")} ${o}\n`,i.push({volume:n,sourceURL:r,title:o,integrity:u})}return i[0].integrity=__chunk_2.hash(s),this.patch({volumes:r,chapters:i})}}exports.Chapter=Chapter,exports.Volume=Volume,exports.Series=Series,exports.default=Series;
//# sourceMappingURL=app.min4.js.map
